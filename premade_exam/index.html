<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>آزمون‌های آماده | ویدا</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');
    
    :root {
      --primary-color: #4f46e5;
      --primary-dark: #4338ca;
      --secondary-color: #10b981;
      --accent-color: #f59e0b;
      --dark-bg: #0f172a;
      --card-bg: #1e293b;
      --gradient-primary: linear-gradient(135deg, #4f46e5 0%, #4338ca 100%);
      --gradient-secondary: linear-gradient(135deg, #10b981 0%, #059669 100%);
      --gradient-accent: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      --gradient-purple: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(135deg, var(--dark-bg) 0%, #1e293b 100%);
      color: #e2e8f0;
      min-height: 100vh;
    }
    
    .nav-gradient {
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .nav-link {
      position: relative;
      padding: 0.5rem 1rem;
      transition: all 0.3s ease;
    }
    
    .nav-link::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 0;
      height: 2px;
      background: var(--gradient-primary);
      transition: width 0.3s ease;
    }
    
    .nav-link:hover::after {
      width: 100%;
    }
    
    .modern-card {
      background: rgba(30, 41, 59, 0.7);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 1.5rem;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow: hidden;
      position: relative;
    }
    
    .modern-card:hover {
      transform: translateY(-10px);
      box-shadow: 
          0 20px 40px rgba(0, 0, 0, 0.3),
          0 0 80px rgba(79, 70, 229, 0.1);
      border-color: rgba(79, 70, 229, 0.3);
    }
    
    .btn-primary {
      background: var(--gradient-primary);
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(79, 70, 229, 0.3);
    }
    
    .btn-secondary {
      background: var(--gradient-secondary);
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
    }
    
    .btn-accent {
      background: var(--gradient-accent);
      color: white;
      padding: 0.75rem 2rem;
      border-radius: 0.75rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .btn-accent:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(245, 158, 11, 0.3);
    }
    
    .gradient-text {
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .subject-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
      margin-left: 0.25rem;
      margin-bottom: 0.25rem;
    }
    
    .subject-badge.biology {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    .subject-badge.physics {
      background: rgba(59, 130, 246, 0.2);
      color: #3b82f6;
      border: 1px solid rgba(59, 130, 246, 0.3);
    }
    
    .subject-badge.chemistry {
      background: rgba(168, 85, 247, 0.2);
      color: #a855f7;
      border: 1px solid rgba(168, 85, 247, 0.3);
    }
    
    .subject-badge.math {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .subject-badge.geology {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .difficulty-badge.easy {
      background: rgba(16, 185, 129, 0.2);
      color: #10b981;
      border: 1px solid rgba(16, 185, 129, 0.3);
    }
    
    .difficulty-badge.medium {
      background: rgba(245, 158, 11, 0.2);
      color: #f59e0b;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }
    
    .difficulty-badge.hard {
      background: rgba(239, 68, 68, 0.2);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .difficulty-badge.very-hard {
      background: rgba(139, 92, 246, 0.2);
      color: #8b5cf6;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }
    
    .tag {
      display: inline-flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.1);
      color: #cbd5e1;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      margin-left: 0.25rem;
      margin-bottom: 0.25rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .animate-fade-in {
      animation: fadeIn 0.4s ease-out forwards;
    }
    
    .loading-spinner {
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid #4f46e5;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .search-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
      width: 100%;
      color: white;
      font-size: 1rem;
      transition: all 0.3s ease;
      font-family: 'Vazirmatn', sans-serif;
    }
    
    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 15px rgba(79, 70, 229, 0.3);
      background: rgba(255, 255, 255, 0.08);
    }
    
    .filter-btn {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: #e2e8f0;
      padding: 0.75rem 1.5rem;
      border-radius: 0.75rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      font-family: 'Vazirmatn', sans-serif;
      font-weight: 500;
    }
    
    .filter-btn:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }
    
    .filter-btn.active {
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.2) 0%, rgba(139, 92, 246, 0.2) 100%);
      border-color: rgba(79, 70, 229, 0.4);
      color: #c7d2fe;
    }
    
    .stat-card {
      background: linear-gradient(135deg, rgba(79, 70, 229, 0.1) 0%, rgba(16, 185, 129, 0.1) 100%);
      border-radius: 1rem;
      padding: 1rem;
      text-align: center;
      border: 1px solid rgba(79, 70, 229, 0.2);
    }
    
    .floating-shapes {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      pointer-events: none;
      z-index: 0;
      overflow: hidden;
    }
    
    .floating-shape {
      position: absolute;
      border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%;
      opacity: 0.1;
      animation: float-shape 15s infinite linear;
    }
    
    @keyframes float-shape {
      0% { transform: translate(0, 0) rotate(0deg); }
      25% { transform: translate(20px, 40px) rotate(90deg); }
      50% { transform: translate(40px, 20px) rotate(180deg); }
      75% { transform: translate(20px, 0px) rotate(270deg); }
      100% { transform: translate(0, 0) rotate(360deg); }
    }
    
    .shape-1 {
      width: 120px;
      height: 120px;
      background: var(--gradient-primary);
      top: 10%;
      left: 10%;
      animation-delay: 0s;
    }
    
    .shape-2 {
      width: 80px;
      height: 80px;
      background: var(--gradient-secondary);
      top: 70%;
      left: 80%;
      animation-delay: -5s;
    }
    
    .shape-3 {
      width: 100px;
      height: 100px;
      background: var(--gradient-accent);
      top: 40%;
      left: 70%;
      animation-delay: -10s;
    }
    
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #94a3b8;
    }
    
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      opacity: 0.5;
    }
    
    .preview-modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      padding: 1rem;
      animation: fadeIn 0.3s ease-out;
    }
    
    @media (max-width: 768px) {
      .modern-card {
        border-radius: 1rem;
      }
      
      .btn-primary, .btn-secondary, .btn-accent {
        padding: 0.6rem 1.5rem;
        font-size: 0.9rem;
      }
      
      .stat-card {
        padding: 0.75rem;
      }
    }
  </style>
</head>
<body class="min-h-screen p-4 md:p-8">
  <!-- شکل‌های شناور در پس‌زمینه -->
  <div class="floating-shapes">
    <div class="floating-shape shape-1"></div>
    <div class="floating-shape shape-2"></div>
    <div class="floating-shape shape-3"></div>
  </div>

  <!-- ناوبری -->
  <nav class="nav-gradient py-4 px-6 fixed top-0 left-0 right-0 z-50">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="flex items-center">
        <a href="/vida/public_exam" class="text-gray-400 hover:text-white ml-4 flex items-center">
          <i class="fas fa-arrow-right text-xl"></i>
          <span class="text-sm mr-2 hidden md:inline">بازگشت</span>
        </a>
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-indigo-500 to-emerald-400 flex items-center justify-center ml-3">
          <i class="fas fa-graduation-cap text-white"></i>
        </div>
        <span class="text-xl font-bold gradient-text">ویدا | آزمون‌های آماده</span>
      </div>
      
      <div class="flex space-x-2 space-x-reverse">
        <a href="/vida/public_exam" class="nav-link text-slate-400 hover:text-slate-200 font-medium">
          <i class="fas fa-home ml-2"></i>
          <span class="hidden md:inline">صفحه اصلی</span>
        </a>
      </div>
    </div>
  </nav>

  <div class="max-w-6xl w-full mx-auto relative z-10 mt-20">
    <!-- سرتیتر -->
    <div class="text-center mb-8 animate-fade-in">
      <h1 class="text-4xl font-bold mb-2 gradient-text">
        <i class="fas fa-box-open ml-2"></i>آزمون‌های از پیش ساخته شده
      </h1>
      <p class="text-gray-400">انتخاب از بین آزمون‌های استاندارد و حرفه‌ای</p>
    </div>

    <!-- آمار کلی -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="stat-card">
        <div class="text-2xl font-bold text-white" id="totalExams">0</div>
        <div class="text-sm text-gray-400">تعداد آزمون‌ها</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-green-400" id="totalQuestions">0</div>
        <div class="text-sm text-gray-400">کل سوالات</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-blue-400" id="totalSubjects">0</div>
        <div class="text-sm text-gray-400">درس‌های پوشش داده</div>
      </div>
      <div class="stat-card">
        <div class="text-2xl font-bold text-purple-400" id="totalTime">0</div>
        <div class="text-sm text-gray-400">دقیقه آزمون</div>
      </div>
    </div>

    <!-- فیلترها و جستجو -->
    <div class="modern-card p-6 mb-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- جستجو -->
        <div>
          <label class="block text-gray-300 mb-2">جستجوی آزمون:</label>
          <input type="text" id="searchInput" placeholder="جستجوی نام، توضیحات یا تگ..." class="search-input">
        </div>
        
        <!-- فیلتر درس -->
        <div>
          <label class="block text-gray-300 mb-2">فیلتر بر اساس درس:</label>
          <div class="flex flex-wrap gap-2">
            <button onclick="filterBySubject('all')" class="filter-btn active" id="filter-all">
              همه دروس
            </button>
            <button onclick="filterBySubject('bio')" class="filter-btn" id="filter-bio">
              <i class="fas fa-dna ml-1"></i> زیست
            </button>
            <button onclick="filterBySubject('phys')" class="filter-btn" id="filter-phys">
              <i class="fas fa-atom ml-1"></i> فیزیک
            </button>
            <button onclick="filterBySubject('chem')" class="filter-btn" id="filter-chem">
              <i class="fas fa-flask ml-1"></i> شیمی
            </button>
            <button onclick="filterBySubject('math')" class="filter-btn" id="filter-math">
              <i class="fas fa-square-root-alt ml-1"></i> ریاضی
            </button>
             <button onclick="filterBySubject('geo')" class="filter-btn" id="filter-geo">
              <i class="fas fa-globe ml-1"></i> زمین
            </button>
          </div>
        </div>
        
        <!-- فیلتر سطح دشواری -->
        <div>
          <label class="block text-gray-300 mb-2">سطح دشواری:</label>
          <div class="flex flex-wrap gap-2">
            <button onclick="filterByDifficulty('all')" class="filter-btn active" id="difficulty-all">
              همه سطوح
            </button>
            <button onclick="filterByDifficulty('easy')" class="filter-btn" id="difficulty-easy">
              <span class="difficulty-badge easy">آسان</span>
            </button>
            <button onclick="filterByDifficulty('medium')" class="filter-btn" id="difficulty-medium">
              <span class="difficulty-badge medium">متوسط</span>
            </button>
            <button onclick="filterByDifficulty('hard')" class="filter-btn" id="difficulty-hard">
              <span class="difficulty-badge hard">دشوار</span>
            </button>
          </div>
        </div>
        
        <!-- مرتب‌سازی -->
        <div>
          <label class="block text-gray-300 mb-2">مرتب‌سازی بر اساس:</label>
          <select id="sortSelect" class="search-input">
            <option value="date">تاریخ (جدیدترین)</option>
            <option value="name">نام الفبایی</option>
            <option value="questions">تعداد سوالات</option>
            <option value="time">زمان آزمون</option>
            <option value="difficulty">سطح دشواری</option>
          </select>
        </div>
      </div>
      
      <!-- دکمه‌های فیلتر فعال -->
      <div id="activeFilters" class="mt-4 flex flex-wrap gap-2">
        <!-- فیلترهای فعال در اینجا نمایش داده می‌شوند -->
      </div>
    </div>

    <!-- لیست آزمون‌ها -->
    <div id="loadingState" class="text-center py-12">
      <div class="loading-spinner mx-auto mb-4"></div>
      <p class="text-gray-400">در حال بارگذاری آزمون‌ها...</p>
    </div>

    <div id="examsList" class="space-y-6"></div>

    <!-- وضعیت خالی -->
    <div id="emptyState" class="empty-state hidden">
      <i class="fas fa-search"></i>
      <h3 class="text-xl font-bold text-gray-300 mb-2">آزمونی یافت نشد</h3>
      <p class="text-gray-500">با تغییر فیلترها، آزمون دیگری را جستجو کنید</p>
    </div>
  </div>

  <!-- مودال پیش‌نمایش -->
  <div id="previewModal" class="preview-modal hidden">
    <div class="modern-card w-full max-w-4xl max-h-[90vh] overflow-y-auto p-6">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-white" id="previewTitle">پیش‌نمایش آزمون</h3>
        <button onclick="closePreview()" class="text-gray-400 hover:text-white text-2xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div id="previewContent" class="space-y-6">
        <!-- محتوای پیش‌نمایش در اینجا بارگذاری می‌شود -->
      </div>
      
      <div class="flex gap-4 mt-8">
        <button onclick="closePreview()" class="btn-accent flex-1">
          <i class="fas fa-times ml-2"></i> بستن
        </button>
        <button onclick="startExamFromPreview()" class="btn-primary flex-1">
          <i class="fas fa-play ml-2"></i> شروع آزمون
        </button>
      </div>
    </div>
  </div>

  <script>
    // داده‌های آزمون
    let allExams = [];
    let filteredExams = [];
    let currentFilters = {
      subject: 'all',
      difficulty: 'all',
      search: ''
    };
    let currentSort = 'date';
    let selectedExam = null;

    // بارگذاری آزمون‌ها
    async function loadExams() {
      try {
        const response = await fetch('https://parhamjanjan.github.io/vida/premade_exam/exams.json');
        if (!response.ok) {
          throw new Error('فایل exams.json یافت نشد');
        }
        const data = await response.json();
        allExams = data.exams;
        
        // به‌روزرسانی آمار
        updateStats();
        
        // اعمال فیلترها و مرتب‌سازی
        applyFiltersAndSort();
        
        // نمایش لیست
        displayExams();
        
        document.getElementById('loadingState').classList.add('hidden');
      } catch (error) {
        console.error('خطا در بارگذاری آزمون‌ها:', error);
        document.getElementById('loadingState').innerHTML = `
          <div class="text-center py-8 text-red-400">
            <i class="fas fa-exclamation-triangle text-4xl mb-4"></i>
            <p>خطا در بارگذاری آزمون‌ها</p>
            <p class="text-sm mt-2">${error.message}</p>
            <button onclick="window.location.reload()" class="mt-4 px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg">
              تلاش مجدد
            </button>
          </div>
        `;
      }
    }

    // به‌روزرسانی آمار
    function updateStats() {
      const totalExams = allExams.length;
      const totalQuestions = allExams.reduce((sum, exam) => {
        return sum + Object.values(exam.subjectCounts).reduce((a, b) => a + b, 0);
      }, 0);
      
      // شمارش درس‌های پوشش داده شده
      const subjectsCovered = new Set();
      allExams.forEach(exam => {
        Object.entries(exam.subjectCounts).forEach(([subject, count]) => {
          if (count > 0) {
            subjectsCovered.add(subject.replace('Count', ''));
          }
        });
      });
      
      const totalTime = allExams.reduce((sum, exam) => sum + exam.time, 0);
      
      document.getElementById('totalExams').textContent = totalExams;
      document.getElementById('totalQuestions').textContent = totalQuestions;
      document.getElementById('totalSubjects').textContent = subjectsCovered.size;
      document.getElementById('totalTime').textContent = totalTime;
    }

    // اعمال فیلترها و مرتب‌سازی
    function applyFiltersAndSort() {
      filteredExams = [...allExams];
      
      // اعمال فیلتر موضوع
      if (currentFilters.subject !== 'all') {
        filteredExams = filteredExams.filter(exam => {
          const subjectKey = currentFilters.subject + 'Count';
          return exam.subjectCounts[subjectKey] > 0;
        });
      }
      
      // اعمال فیلتر سطح دشواری
      if (currentFilters.difficulty !== 'all') {
        filteredExams = filteredExams.filter(exam => {
          const difficultyMap = {
            'easy': ['آسان'],
            'medium': ['متوسط'],
            'hard': ['دشوار', 'خیلی دشوار']
          };
          
          if (currentFilters.difficulty === 'all') return true;
          const difficulties = difficultyMap[currentFilters.difficulty];
          return difficulties && difficulties.some(d => exam.difficulty.includes(d));
        });
      }
      
      // اعمال جستجو
      if (currentFilters.search.trim() !== '') {
        const searchTerm = currentFilters.search.toLowerCase();
        filteredExams = filteredExams.filter(exam => 
          exam.name.toLowerCase().includes(searchTerm) ||
          (exam.description && exam.description.toLowerCase().includes(searchTerm)) ||
          (exam.tags && exam.tags.some(tag => tag.toLowerCase().includes(searchTerm)))
        );
      }
      
      // مرتب‌سازی
      switch(currentSort) {
        case 'name':
          filteredExams.sort((a, b) => a.name.localeCompare(b.name, 'fa'));
          break;
        case 'questions':
          filteredExams.sort((a, b) => {
            const aTotal = Object.values(a.subjectCounts).reduce((sum, val) => sum + val, 0);
            const bTotal = Object.values(b.subjectCounts).reduce((sum, val) => sum + val, 0);
            return bTotal - aTotal;
          });
          break;
        case 'time':
          filteredExams.sort((a, b) => b.time - a.time);
          break;
        case 'difficulty':
          const difficultyOrder = { 'خیلی دشوار': 4, 'دشوار': 3, 'متوسط': 2, 'آسان': 1 };
          filteredExams.sort((a, b) => {
            const aOrder = difficultyOrder[a.difficulty] || 2;
            const bOrder = difficultyOrder[b.difficulty] || 2;
            return bOrder - aOrder;
          });
          break;
        case 'date':
        default:
          // فرض می‌کنیم تاریخ به فرمت YYYY/MM/DD است
          filteredExams.sort((a, b) => {
            const aParts = a.date.split('/').map(Number);
            const bParts = b.date.split('/').map(Number);
            
            // مقایسه سال
            if (aParts[0] !== bParts[0]) return bParts[0] - aParts[0];
            // مقایسه ماه
            if (aParts[1] !== bParts[1]) return bParts[1] - aParts[1];
            // مقایسه روز
            return bParts[2] - aParts[2];
          });
          break;
      }
      
      updateActiveFilters();
    }

    // نمایش آزمون‌ها
    function displayExams() {
      const examsList = document.getElementById('examsList');
      const emptyState = document.getElementById('emptyState');
      
      if (filteredExams.length === 0) {
        examsList.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      examsList.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      examsList.innerHTML = filteredExams.map((exam, index) => {
        const totalQuestions = Object.values(exam.subjectCounts).reduce((a, b) => a + b, 0);
        
        return `
        <div class="modern-card p-6 animate-fade-in" style="animation-delay: ${index * 0.05}s">
          <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6">
            <!-- اطلاعات اصلی -->
            <div class="flex-1">
              <div class="flex items-start justify-between mb-3">
                <div>
                  <h3 class="text-xl font-bold text-white mb-2">${exam.name}</h3>
                  <p class="text-gray-400 mb-3">${exam.description || 'بدون توضیحات'}</p>
                </div>
                <span class="difficulty-badge ${getDifficultyClass(exam.difficulty)}">
                  ${exam.difficulty}
                </span>
              </div>
              
              <!-- آمار آزمون -->
              <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <div class="bg-gray-800/50 p-3 rounded-lg">
                  <div class="text-sm text-gray-400">سوالات</div>
                  <div class="text-lg font-bold text-white">
                    ${totalQuestions}
                  </div>
                </div>
                
                <div class="bg-gray-800/50 p-3 rounded-lg">
                  <div class="text-sm text-gray-400">زمان</div>
                  <div class="text-lg font-bold text-yellow-400">${exam.time} دقیقه</div>
                </div>
                
                <div class="bg-gray-800/50 p-3 rounded-lg">
                  <div class="text-sm text-gray-400">تاریخ</div>
                  <div class="text-lg font-bold text-blue-400">${exam.date}</div>
                </div>
                
                <div class="bg-gray-800/50 p-3 rounded-lg">
                  <div class="text-sm text-gray-400">پاسخنامه</div>
                  <div class="text-lg font-bold ${exam.answerKey ? 'text-green-400' : 'text-gray-400'}">
                    <i class="fas fa-key"></i>
                  </div>
                </div>
              </div>
              
              <!-- درس‌ها -->
              <div class="mb-4">
                <div class="text-sm text-gray-400 mb-2">درس‌های آزمون:</div>
                <div class="flex flex-wrap gap-2">
                  ${Object.entries(exam.subjectCounts)
                    .filter(([_, count]) => count > 0)
                    .map(([subject, count]) => `
                      <span class="subject-badge ${getSubjectClass(subject)}">
                        <i class="fas ${getSubjectIcon(subject)} ml-1"></i>
                        ${getSubjectName(subject)} (${count})
                      </span>
                    `).join('')}
                </div>
              </div>
              
              <!-- تگ‌ها -->
              ${exam.tags && exam.tags.length > 0 ? `
                <div>
                  <div class="flex flex-wrap gap-2">
                    ${exam.tags.map(tag => `
                      <span class="tag">
                        <i class="fas fa-tag ml-1"></i>
                        ${tag}
                      </span>
                    `).join('')}
                  </div>
                </div>
              ` : ''}
            </div>
            
            <!-- دکمه‌های عملی -->
            <div class="flex flex-col gap-3 w-full md:w-auto">
              <button onclick="previewExam(${exam.id})" class="btn-accent">
                <i class="fas fa-eye ml-2"></i> پیش‌نمایش
              </button>
              <button onclick="startExam(${exam.id})" class="btn-primary">
                <i class="fas fa-play ml-2"></i> شروع آزمون
              </button>
              ${exam.pdfFile ? `
                <button onclick="downloadPDF('${exam.pdfFile}')" class="btn-secondary">
                  <i class="fas fa-download ml-2"></i> دانلود PDF
                </button>
              ` : ''}
            </div>
          </div>
        </div>
      `;
      }).join('');
    }

    // فیلتر بر اساس درس
    function filterBySubject(subject) {
      currentFilters.subject = subject;
      
      // به‌روزرسانی دکمه‌های فعال
      document.querySelectorAll('#filter-all, #filter-biology, #filter-physics, #filter-chemistry, #filter-math').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`filter-${subject}`).classList.add('active');
      
      applyFiltersAndSort();
      displayExams();
    }

    // فیلتر بر اساس سطح دشواری
    function filterByDifficulty(difficulty) {
      currentFilters.difficulty = difficulty;
      
      // به‌روزرسانی دکمه‌های فعال
      document.querySelectorAll('#difficulty-all, #difficulty-easy, #difficulty-medium, #difficulty-hard').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(`difficulty-${difficulty}`).classList.add('active');
      
      applyFiltersAndSort();
      displayExams();
    }

    // جستجوی آزمون‌ها
    function searchExams() {
      currentFilters.search = document.getElementById('searchInput').value;
      applyFiltersAndSort();
      displayExams();
    }

    // مرتب‌سازی آزمون‌ها
    function sortExams() {
      currentSort = document.getElementById('sortSelect').value;
      applyFiltersAndSort();
      displayExams();
    }

    // به‌روزرسانی فیلترهای فعال
    function updateActiveFilters() {
      const activeFiltersDiv = document.getElementById('activeFilters');
      let filters = [];
      
      if (currentFilters.subject !== 'all') {
        filters.push(`درس: ${getSubjectName(currentFilters.subject + 'Count')}`);
      }
      
      if (currentFilters.difficulty !== 'all') {
        const difficultyNames = {
          'easy': 'آسان',
          'medium': 'متوسط',
          'hard': 'دشوار'
        };
        filters.push(`سطح: ${difficultyNames[currentFilters.difficulty] || currentFilters.difficulty}`);
      }
      
      if (currentFilters.search.trim() !== '') {
        filters.push(`جستجو: "${currentFilters.search}"`);
      }
      
      if (filters.length > 0) {
        activeFiltersDiv.innerHTML = `
          <div class="flex items-center flex-wrap gap-2">
            <span class="text-gray-400 text-sm">فیلترهای فعال:</span>
            ${filters.map(filter => `
              <span class="tag">
                ${filter}
                <button onclick="removeFilter('${filter.split(':')[0].trim()}')" class="mr-1">
                  <i class="fas fa-times text-xs"></i>
                </button>
              </span>
            `).join('')}
            <button onclick="clearAllFilters()" class="text-sm text-purple-400 hover:text-purple-300">
              <i class="fas fa-times-circle ml-1"></i> پاک کردن همه
            </button>
          </div>
        `;
      } else {
        activeFiltersDiv.innerHTML = '';
      }
    }

    // حذف فیلتر
    function removeFilter(filterType) {
      switch(filterType) {
        case 'درس':
          filterBySubject('all');
          break;
        case 'سطح':
          filterByDifficulty('all');
          break;
        case 'جستجو':
          document.getElementById('searchInput').value = '';
          currentFilters.search = '';
          applyFiltersAndSort();
          displayExams();
          break;
      }
    }

    // پاک کردن همه فیلترها
    function clearAllFilters() {
      filterBySubject('all');
      filterByDifficulty('all');
      document.getElementById('searchInput').value = '';
      currentFilters.search = '';
      document.getElementById('sortSelect').value = 'date';
      currentSort = 'date';
      applyFiltersAndSort();
      displayExams();
    }

    // پیش‌نمایش آزمون
    async function previewExam(examId) {
      
      const exam = allExams.find(e => e.id === examId);
      console.log(exam)
      if (!exam) return;
      
      selectedExam = exam;
      
      // محاسبه تعداد کل سوالات
      const totalQuestions = Object.values(exam.subjectCounts).reduce((a, b) => a + b, 0);
      
      // بارگذاری کلید پاسخ
      let answerKeyInfo = '';
      try {
        if (exam.answerKey) {
          const response = await fetch(exam.answerKey);
          if (response.ok) {
            const keyData = await response.json();
            answerKeyInfo = `
              <div class="bg-green-500/10 p-4 rounded-lg">
                <div class="flex items-center text-green-400 mb-2">
                  <i class="fas fa-key ml-2"></i>
                  <span>کلید پاسخ موجود است</span>
                </div>
                <p class="text-sm text-gray-300">کلید پاسخ برای ${Object.keys(keyData.answers || {}).length} درس آماده است</p>
              </div>
            `;
          }
        }
      } catch (error) {
        answerKeyInfo = `
          <div class="bg-yellow-500/10 p-4 rounded-lg">
            <div class="flex items-center text-yellow-400 mb-2">
              <i class="fas fa-exclamation-triangle ml-2"></i>
              <span>کلید پاسخ یافت نشد</span>
            </div>
          </div>
        `;
      }
      
      document.getElementById('previewTitle').textContent = `پیش‌نمایش: ${exam.name}`;
      document.getElementById('previewContent').innerHTML = `
        <div class="space-y-6">
          <!-- اطلاعات کلی -->
          <div class="bg-gray-800/50 p-6 rounded-lg">
            <h4 class="text-lg font-bold text-white mb-4">اطلاعات آزمون</h4>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label class="text-gray-400 text-sm">توضیحات:</label>
                <p class="text-white">${exam.description || 'بدون توضیحات'}</p>
              </div>
              <div>
                <label class="text-gray-400 text-sm">تاریخ انتشار:</label>
                <p class="text-white">${exam.date}</p>
              </div>
              <div>
                <label class="text-gray-400 text-sm">مدت زمان:</label>
                <p class="text-white">${exam.time} دقیقه</p>
              </div>
              <div>
                <label class="text-gray-400 text-sm">سطح دشواری:</label>
                <p class="text-white">
                  <span class="difficulty-badge ${getDifficultyClass(exam.difficulty)}">
                    ${exam.difficulty}
                  </span>
                </p>
              </div>
            </div>
          </div>
          
          <!-- جزئیات سوالات -->
          <div class="bg-gray-800/50 p-6 rounded-lg">
            <h4 class="text-lg font-bold text-white mb-4">جزئیات سوالات</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
              <div class="text-center p-4 bg-gray-700/30 rounded-lg">
                <div class="text-2xl font-bold text-white">${totalQuestions}</div>
                <div class="text-sm text-gray-400">کل سوالات</div>
              </div>
              
              ${Object.entries(exam.subjectCounts)
                .filter(([_, count]) => count > 0)
                .map(([subject, count]) => `
                  <div class="text-center p-4 bg-gray-700/30 rounded-lg">
                    <div class="text-xl font-bold text-white">${count}</div>
                    <div class="text-sm ${getSubjectColor(subject)}">${getSubjectName(subject)}</div>
                  </div>
                `).join('')}
            </div>
          </div>
          
          <!-- اطلاعات فایل‌ها -->
          <div class="bg-gray-800/50 p-6 rounded-lg">
            <h4 class="text-lg font-bold text-white mb-4">فایل‌های مرتبط</h4>
            <div class="space-y-4">
              ${exam.pdfFile ? `
                <div class="flex items-center justify-between p-4 bg-gray-700/30 rounded-lg">
                  <div class="flex items-center">
                    <i class="fas fa-file-pdf text-red-400 text-xl ml-3"></i>
                    <div>
                      <div class="text-white font-medium">فایل PDF سوالات</div>
                      <div class="text-sm text-gray-400">${exam.pdfFile}</div>
                    </div>
                  </div>
                  <button onclick="downloadPDF('${exam.pdfFile}')" class="btn-secondary text-sm px-3 py-1">
                    <i class="fas fa-download ml-1"></i> دانلود
                  </button>
                </div>
              ` : '<p class="text-gray-400 text-center">فایل PDF موجود نیست</p>'}
              
              ${answerKeyInfo}
            </div>
          </div>
          
          <!-- نکات مهم -->
          <div class="bg-blue-500/10 p-6 rounded-lg">
            <h4 class="text-lg font-bold text-white mb-4 flex items-center">
              <i class="fas fa-lightbulb ml-2 text-yellow-400"></i>
              نکات مهم
            </h4>
            <ul class="space-y-2 text-gray-300">
              <li class="flex items-start">
                <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                <span>این آزمون به صورت خودکار تنظیمات را پر می‌کند</span>
              </li>
              ${exam.pdfFile ? `
                <li class="flex items-start">
                  <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                  <span>فایل PDF به صورت خودکار بارگذاری می‌شود</span>
                </li>
              ` : ''}
              ${exam.answerKey ? `
                <li class="flex items-start">
                  <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                  <span>کلید پاسخ‌ها به صورت خودکار وارد می‌شود</span>
                </li>
              ` : ''}
              <li class="flex items-start">
                <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                <span>ذخیره نتیجه آزمون فراموش نشود</span>
              </li>
               <li class="flex items-start">
                <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                <span>لطفا تا بارگزاری کامل سوالات صبر کنید آزمون دارای 1 دقیقه تایم اضافه است</span>
              </li>

               <li class="flex items-start">
                <i class="fas fa-check text-green-400 ml-2 mt-1"></i>
                <span>اگر آزمون شروع شد ولی بالای گزینه ها نه صفحه لود شدن دیدید نه سوال از قسمت آزمون های فعال از ابتدا وارد آزمون شوید</span>
              </li>
            </ul>
          </div>
        </div>
      `;
      
      document.getElementById('previewModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    // بستن پیش‌نمایش
    function closePreview() {
      document.getElementById('previewModal').classList.add('hidden');
      document.body.style.overflow = 'auto';
    }

    // شروع آزمون
    async function startExam(examId) {
      const exam = allExams.find(e => e.id === examId);
      if (!exam) return;
      
      try {
        showNotification('در حال آماده‌سازی آزمون...');
        
        // بارگذاری کلید پاسخ
        let answerKey = null;
        try {
          if (exam.answerKey) {
            const response = await fetch(exam.answerKey);
            if (response.ok) {
              answerKey = await response.json();
            }
          }
        } catch (error) {
          console.warn('کلید پاسخ یافت نشد:', error);
        }
        
        // ایجاد داده‌های آزمون برای انتقال
        const examData = {
          id: exam.id,
          name: exam.name,
          subjectCounts: exam.subjectCounts,
          time: exam.time,
          pdfFile: exam.pdfFile,
          answerKey: answerKey,
          difficulty: exam.difficulty,
          tags: exam.tags || [],
          date: exam.date,
          description: exam.description || '',
          isPremade: true,
          timestamp: new Date().toISOString()
        };
        
        // ذخیره در localStorage
        localStorage.setItem('selected_premade_exam', JSON.stringify(examData));
        console.log("OOOOOKKKKK")
        // هدایت به صفحه اصلی
        window.location.href = '/vida/public_exam';
        
      } catch (error) {
        console.error('خطا در شروع آزمون:', error);
        showNotification('خطا در شروع آزمون');
      }
    }

    // شروع آزمون از پیش‌نمایش
    function startExamFromPreview() {
      if (selectedExam) {
        closePreview();
        console.log(selectedExam)
        startExam(selectedExam.id);
      }
    }

    // دانلود PDF
    function downloadPDF(filename) {
      const link = document.createElement('a');
      link.href = filename;
      link.download = filename;
      link.target = '_blank';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // نمایش نوتیفیکیشن
    function showNotification(message) {
      const notification = document.createElement('div');
      notification.className = 'fixed top-4 right-4 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg border-l-4 border-green-500 flex items-center z-50 animate-fade-in';
      notification.innerHTML = `
        <i class="fas fa-info-circle ml-2 text-green-400"></i>
        <span>${message}</span>
      `;
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // توابع کمکی
    function getSubjectName(subjectKey) {
      const subjectMap = {
        'bioCount': 'زیست‌شناسی',
        'physCount': 'فیزیک',
        'chemCount': 'شیمی',
        'mathCount': 'ریاضی',
        'geoCount': 'زمین‌شناسی'
      };
      return subjectMap[subjectKey] || subjectKey;
    }

    function getSubjectClass(subjectKey) {
      const classMap = {
        'bioCount': 'biology',
        'physCount': 'physics',
        'chemCount': 'chemistry',
        'mathCount': 'math',
        'geoCount': 'geology'
      };
      return classMap[subjectKey] || '';
    }

    function getSubjectIcon(subjectKey) {
      const iconMap = {
        'bioCount': 'fa-dna',
        'physCount': 'fa-atom',
        'chemCount': 'fa-flask',
        'mathCount': 'fa-square-root-alt',
        'geoCount': 'fa-mountain'
      };
      return iconMap[subjectKey] || 'fa-question';
    }

    function getSubjectColor(subjectKey) {
      const colorMap = {
        'bioCount': 'text-green-400',
        'physCount': 'text-blue-400',
        'chemCount': 'text-purple-400',
        'mathCount': 'text-yellow-400',
        'geoCount': 'text-red-400'
      };
      return colorMap[subjectKey] || 'text-gray-400';
    }

    function getDifficultyClass(difficulty) {
      if (!difficulty) return 'medium';
      
      const difficultyLower = difficulty.toLowerCase();
      if (difficultyLower.includes('آسان')) return 'easy';
      if (difficultyLower.includes('متوسط')) return 'medium';
      if (difficultyLower.includes('دشوار')) return 'hard';
      if (difficultyLower.includes('خیلی')) return 'very-hard';
      return 'medium';
    }

    // رویدادهای جستجو
    document.getElementById('searchInput').addEventListener('input', searchExams);
    document.getElementById('sortSelect').addEventListener('change', sortExams);

    // بستن مودال با Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && !document.getElementById('previewModal').classList.contains('hidden')) {
        closePreview();
      }
    });

    // کلیک خارج از مودال
    document.getElementById('previewModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closePreview();
      }
    });

    // بارگذاری اولیه
    document.addEventListener('DOMContentLoaded', function() {
      loadExams();
    });
  </script>
</body>
</html>
